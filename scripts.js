const albumCoverdzungla = "https://cdn-images.dzcdn.net/images/cover/4fdff6bb5e3cc929e69746a684e7f9d5/0x1900-000000-80-0-0.jpg";
const albumCoverURL = "https://cdn-images.dzcdn.net/images/cover/e751ff82ccc4994421a21ceabafc7318/0x1900-000000-80-0-0.jpg";
const albumCoverBrakKontroli = "https://i.scdn.co/image/ab67616d0000b27391cce8e6f77a32d4d8e90226";

const songs = [
  // Album: Dżungla (15 października 2021)
  { title: "My Kontra Oni", album: "Dżungla", trackNumber: 1, length: 119, features: [], spotify: "LINK", youtube: "LINK", cover: albumCoverdzungla },
  { title: "Mięta", album: "Dżungla", trackNumber: 2, length: 168, features: [], spotify: "LINK", youtube: "LINK", cover: albumCoverdzungla },
  { title: "Smi", album: "Dżungla", trackNumber: 3, length: 196, features: [], spotify: "LINK", youtube: "LINK", cover: albumCoverdzungla },
  { title: "To I Tamto (feat. Schafter)", album: "Dżungla", trackNumber: 4, length: 179, features: ["Schafter"], spotify: "LINK", youtube: "LINK", cover: albumCoverdzungla },
  { title: "Hannah Montana", album: "Dżungla", trackNumber: 5, length: 233, features: [], spotify: "LINK", youtube: "LINK", cover: albumCoverdzungla },
  { title: "Crazy Frog", album: "Dżungla", trackNumber: 6, length: 230, features: [], spotify: "LINK", youtube: "LINK", cover: albumCoverdzungla },
  { title: "Toksyny", album: "Dżungla", trackNumber: 7, length: 215, features: [], spotify: "LINK", youtube: "LINK", cover: albumCoverdzungla },
  { title: "Bozo", album: "Dżungla", trackNumber: 8, length: 205, features: [], spotify: "LINK", youtube: "LINK", cover: albumCoverdzungla },
  { title: "Jestem W Stanie (feat. Pazzy)", album: "Dżungla", trackNumber: 9, length: 225, features: ["Pazzy"], spotify: "LINK", youtube: "LINK", cover: albumCoverdzungla },
  { title: "Wwv (feat. White Widow)", album: "Dżungla", trackNumber: 10, length: 240, features: ["White Widow"], spotify: "LINK", youtube: "LINK", cover: albumCoverdzungla },
  { title: "Daj Pare Mi", album: "Dżungla", trackNumber: 11, length: 210, features: [], spotify: "LINK", youtube: "LINK", cover: albumCoverdzungla },
  { title: "Nauczyłem Się", album: "Dżungla", trackNumber: 12, length: 200, features: [], spotify: "LINK", youtube: "LINK", cover: albumCoverdzungla },
  { title: "Twoja Liga Niska (feat. Astrogxral)", album: "Dżungla", trackNumber: 13, length: 230, features: ["Astrogxral"], spotify: "LINK", youtube: "LINK", cover: albumCoverdzungla },
  { title: "Aleppo", album: "Dżungla", trackNumber: 14, length: 220, features: [], spotify: "LINK", youtube: "LINK", cover: albumCoverdzungla },
  { title: "Algorytm (feat. MłodyBa)", album: "Dżungla", trackNumber: 15, length: 235, features: ["MłodyBa"], spotify: "LINK", youtube: "LINK", cover: albumCoverdzungla },
  { title: "Jeb Twoich Ziomów", album: "Dżungla", trackNumber: 16, length: 250, features: [], spotify: "LINK", youtube: "LINK", cover: albumCoverdzungla },
  { title: "Big Jungle Shit (Outro)", album: "Dżungla", trackNumber: 17, length: 180, features: [], spotify: "LINK", youtube: "LINK", cover: albumCoverdzungla },
  { title: "Kochanie Zrozum Mnie [Bonus Track]", album: "Dżungla", trackNumber: 18, length: 240, features: [], spotify: "LINK", youtube: "LINK", cover: albumCoverdzungla },
  { title: "Pustka [Bonus Track] (feat. Olszakumpel)", album: "Dżungla", trackNumber: 19, length: 230, features: ["Olszakumpel"], spotify: "LINK", youtube: "LINK", cover: albumCoverdzungla },

  // EP: Brak Kontroli (15 lipca 2022)
  { title: "Tani Luz", album: "Brak Kontroli", trackNumber: 1, length: 131, features: ["Rusina"], spotify: "LINK", youtube: "LINK", cover: albumCoverBrakKontroli },
  { title: "OGCALI", album: "Brak Kontroli", trackNumber: 2, length: 158, features: [], spotify: "LINK", youtube: "LINK", cover: albumCoverBrakKontroli },
  { title: "Nie Umrę Stary I Spłukany", album: "Brak Kontroli", trackNumber: 3, length: 188, features: [], spotify: "LINK", youtube: "LINK", cover: albumCoverBrakKontroli },
  { title: "Dwa Kroki W Tył", album: "Brak Kontroli", trackNumber: 4, length: 160, features: [], spotify: "LINK", youtube: "LINK", cover: albumCoverBrakKontroli },
  { title: "Fly", album: "Brak Kontroli", trackNumber: 5, length: 268, features: ["WHITE WIDOW", "Yung Adisz"], spotify: "LINK", youtube: "LINK", cover: albumCoverBrakKontroli },
  { title: "Ciężko Wam To Przyjąć", album: "Brak Kontroli", trackNumber: 6, length: 128, features: [], spotify: "LINK", youtube: "LINK", cover: albumCoverBrakKontroli },
  { title: "Mali Chłopcy", album: "Brak Kontroli", trackNumber: 7, length: 152, features: [], spotify: "LINK", youtube: "LINK", cover: albumCoverBrakKontroli },


  // Album: BARBARA (23 sierpnia 2024)
  { title: "Intro", album: "Barbara", trackNumber: 1, length: 175, features: [], spotify: "LINK", youtube: "LINK", cover: albumCoverURL },
  { title: "Despero", album: "Barbara", trackNumber: 2, length: 169, features: [], spotify: "LINK", youtube: "LINK", cover: albumCoverURL },
  { title: "Gadu Gadu", album: "Barbara", trackNumber: 3, length: 133, features: [], spotify: "LINK", youtube: "LINK", cover: albumCoverURL },
  { title: "Fisherprice", album: "Barbara", trackNumber: 4, length: 247, features: ["Pazzy"], spotify: "LINK", youtube: "LINK", cover: albumCoverURL },
  { title: "Jak Mam Wstać?", album: "Barbara", trackNumber: 5, length: 177, features: [], spotify: "LINK", youtube: "LINK", cover: albumCoverURL },
  { title: "Ekran", album: "Barbara", trackNumber: 6, length: 181, features: [], spotify: "LINK", youtube: "LINK", cover: albumCoverURL },
  { title: "Break Time", album: "Barbara", trackNumber: 7, length: 180, features: [], spotify: "LINK", youtube: "LINK", cover: albumCoverURL },
  { title: "W Moich Stronach", album: "Barbara", trackNumber: 8, length: 182, features: [], spotify: "LINK", youtube: "LINK", cover: albumCoverURL },
  { title: "Kiedy Zachodzi Słońce", album: "Barbara", trackNumber: 9, length: 200, features: ["Aleshen"], spotify: "LINK", youtube:"LINK", cover: albumCoverURL },
  { title: "Po Temacie", album: "Barbara", trackNumber: 10, length: 180, features: [], spotify: "LINK", youtube: "LINK", cover: albumCoverURL },
  { title: "Jak Film", album: "Barbara", trackNumber: 11, length: 190, features: [], spotify: "LINK", youtube: "LINK", cover: albumCoverURL },
  { title: "Od SK do Saskiej", album: "Barbara", trackNumber: 12, length: 210, features: ["HAŁASTRA"], spotify: "LINK", youtube: "LINK", cover: albumCoverURL },
  { title: "Flegma", album: "Barbara", trackNumber: 13, length: 200, features: [], spotify: "LINK", youtube: "LINK", cover: albumCoverURL },
  { title: "Wciąż Jestem Chory", album: "Barbara", trackNumber: 14, length: 220, features: [], spotify: "LINK", youtube: "LINK", cover: albumCoverURL },
  { title: "Barbara", album: "Barbara", trackNumber: 15, length: 230, features: [], spotify: "LINK", youtube: "LINK", cover: albumCoverURL },
  { title: "Synergia", album: "Barbara", trackNumber: 16, length: 240, features: [], spotify: "LINK", youtube: "LINK", cover: albumCoverURL },
  { title: "Outro", album: "Barbara", trackNumber: 17, length: 250, features: [], spotify: "LINK", youtube: "LINK", cover: albumCoverURL },
  { title: "4 Pancerni", album: "Barbara", trackNumber: 18, length: 260, features: [], spotify: "LINK", youtube: "LINK", cover: albumCoverURL },


  // Single (realne utwory wydane po "Dżungli")
  { title: "Nie Miej Pretensji", album: "Single", length: 230, features: ["Macias", "White Widow"], spotify: "LINK", youtube: "LINK", cover: albumCoverURL },
  { title: "120 Wersów Żeby Zaje*ać Co Wasze", album: "Single", length: 300, features: [], spotify: "LINK", youtube: "LINK", cover: albumCoverURL },
  { title: "Zemsta (feat. Rusina)", album: "Single", length: 245, features: ["Rusina"], spotify: "LINK", youtube: "LINK", cover: albumCoverURL },
  { title: "2025 FREESTYLE", album: "Single", length: 205, features: [], spotify: "LINK", youtube: "LINK", cover: albumCoverURL }
];

let eliminatedTitles = [];
let secretSong = null;
let attempts = 0;
let gameOver = false;

const guessInput = document.getElementById("guessInput");
const guessBtn = document.getElementById("guessBtn");
const board = document.getElementById("board");
const resultMessage = document.getElementById("resultMessage");
const coverImage = document.getElementById("coverImage");
const restartBtn = document.getElementById("restartBtn");
const suggestionsContainer = document.getElementById("suggestions");
const particleContainer = document.getElementById("particle-container");
const mediaButtons = document.getElementById("mediaButtons");

function handleSuggestions() {
  const query = guessInput.value.trim().toLowerCase();
  suggestionsContainer.innerHTML = "";
  if (!query) {
    suggestionsContainer.style.display = "none";
    return;
  }
  const matchedSongs = songs.filter(song =>
    song.title.toLowerCase().includes(query) &&
    !eliminatedTitles.includes(song.title.toLowerCase())
  );
  if (matchedSongs.length === 0) {
    suggestionsContainer.style.display = "none";
    return;
  }
  matchedSongs.forEach(song => {
    const item = document.createElement("div");
    item.classList.add("suggestion-item");
    item.textContent = song.title;
    item.addEventListener("click", () => {
      guessInput.value = song.title;
      suggestionsContainer.innerHTML = "";
      suggestionsContainer.style.display = "none";
    });
    suggestionsContainer.appendChild(item);
  });
  suggestionsContainer.style.display = "block";
}

guessInput.addEventListener("input", handleSuggestions);

function getArrow(guess, secret) {
  if (guess < secret) return " ↑";
  if (guess > secret) return " ↓";
  return "";
}

function compareAlbum(guessAlbum, secretAlbum) {
  if (guessAlbum === secretAlbum) {
    return { status: "correct", label: guessAlbum };
  }
  return { status: "wrong", label: guessAlbum };
}

function compareTrackNumber(guessNum, secretNum) {
  if (guessNum === secretNum) {
    return { status: "correct", label: guessNum };
  }
  if (guessNum < secretNum) {
    return { status: "wrong", label: guessNum + " ↑" };
  }
  if (guessNum > secretNum) {
    return { status: "wrong", label: guessNum + " ↓" };
  }
  return { status: "wrong", label: guessNum };
}

function compareLength(guessLen, secretLen) {
  if (guessLen === secretLen) {
    return { status: "correct", label: formatLength(guessLen) };
  }
  if (guessLen < secretLen) {
    return { status: "wrong", label: formatLength(guessLen) + " ↑" };
  }
  if (guessLen > secretLen) {
    return { status: "wrong", label: formatLength(guessLen) + " ↓" };
  }
  return { status: "wrong", label: formatLength(guessLen) };
}

function compareFeatures(guessFeatures, secretFeatures) {
  const guessLower = guessFeatures.map(f => f.toLowerCase());
  const secretLower = secretFeatures.map(f => f.toLowerCase());
  if (guessLower.length === secretLower.length &&
      guessLower.every(f => secretLower.includes(f))) {
    return { status: "correct", label: guessFeatures.join(", ") || "Brak" };
  }
  const intersection = guessLower.filter(f => secretLower.includes(f));
  if (intersection.length > 0) {
    return { status: "close", label: guessFeatures.join(", ") || "Brak" };
  }
  return { status: "wrong", label: guessFeatures.join(", ") || "Brak" };
}

function formatLength(seconds) {
  const m = Math.floor(seconds / 60);
  const s = seconds % 60;
  return `${m}:${s.toString().padStart(2, "0")}`;
}

function addGuessRow(guessData) {
  const rowCells = [];
  const columns = ["title", "album", "trackNumber", "length", "features"];
  columns.forEach(col => {
    const cell = document.createElement("div");
    cell.classList.add("cell", guessData[col].status);
    cell.textContent = guessData[col].label;
    rowCells.push(cell);
  });
  const rowContainer = document.createElement("div");
  rowContainer.classList.add("guess-row");
  rowCells.forEach(cell => rowContainer.appendChild(cell));
  board.appendChild(rowContainer);
}

function spawnParticles() {
  const colors = ["#ffcc00", "#ff6699", "#66ccff", "#99ff66", "#ff9900"];
  const numParticles = 450; 
  
  const originX = window.innerWidth / 2; 
  const originY = window.innerHeight / 2; 

  for (let i = 0; i < numParticles; i++) {
    const particle = document.createElement("div");
    particle.classList.add("particle");
    const color = colors[Math.floor(Math.random() * colors.length)];
    particle.style.setProperty("--color", color);
    particle.style.left = originX + "px";
    particle.style.top = originY + "px";
    
    const tx = (Math.random() - 0.5) * window.innerWidth * 2;  
    const ty = (Math.random() - 0.5) * window.innerHeight * 2;  
    particle.style.setProperty("--tx", tx + "px");
    particle.style.setProperty("--ty", ty + "px");
    
    document.body.appendChild(particle);
    particle.addEventListener("animationend", () => {
      particle.remove();
    });
  }
}


function handleGuess() {
  if (gameOver) return;
  const guessTitle = guessInput.value.trim();
  if (!guessTitle) return;
  const guessedSong = songs.find(song => song.title.toLowerCase() === guessTitle.toLowerCase());

  attempts++;

  if (!guessedSong) {
    addGuessRow({
      title: { status: "wrong", label: guessTitle },
      album: { status: "wrong", label: "Nieznany tytuł" },
      trackNumber: { status: "wrong", label: "–" },
      length: { status: "wrong", label: "–" },
      features: { status: "wrong", label: "–" }
    });
    resultMessage.textContent = `Piosenka "${guessTitle}" nie została znaleziona.`;
  } else {
    if (!eliminatedTitles.includes(guessedSong.title.toLowerCase())) {
      eliminatedTitles.push(guessedSong.title.toLowerCase());
    }

    const titleData = {
      status: (guessedSong.title.toLowerCase() === secretSong.title.toLowerCase()) ? "correct" : "wrong",
      label: guessedSong.title
    };
    const albumData = compareAlbum(guessedSong.album, secretSong.album);
    const trackData = compareTrackNumber(guessedSong.trackNumber, secretSong.trackNumber);
    const lengthData = compareLength(guessedSong.length, secretSong.length);
    const featuresData = compareFeatures(guessedSong.features, secretSong.features);

    addGuessRow({
      title: titleData,
      album: albumData,
      trackNumber: trackData,
      length: lengthData,
      features: featuresData
    });

    if (guessedSong.title.toLowerCase() === secretSong.title.toLowerCase()) {
      endGame(true);
      return;
    }
  }

  updateSuggestions();

  if (attempts >= 8) {
    endGame(false);
    return;
  }

  guessInput.value = "";
  suggestionsContainer.innerHTML = "";
  suggestionsContainer.style.display = "none";
}

function handleSuggestions() {
  const query = guessInput.value.trim().toLowerCase();
  suggestionsContainer.innerHTML = "";
  if (!query) {
    suggestionsContainer.style.display = "none";
    return;
  }

  const matchedSongs = songs.filter(song =>
    song.title.toLowerCase().includes(query) &&
    !eliminatedTitles.includes(song.title.toLowerCase()) 
  );

  if (matchedSongs.length === 0) {
    suggestionsContainer.style.display = "none";
    return;
  }

  matchedSongs.forEach(song => {
    const item = document.createElement("div");
    item.classList.add("suggestion-item");
    item.textContent = song.title;
    item.addEventListener("click", () => {
      guessInput.value = song.title;
      suggestionsContainer.innerHTML = "";
      suggestionsContainer.style.display = "none";
    });
    suggestionsContainer.appendChild(item);
  });

  suggestionsContainer.style.display = "block";
}

function updateSuggestions() {
  handleSuggestions();
}

function endGame(win) {
  gameOver = true;
  guessInput.disabled = true;
  guessBtn.disabled = true;
  restartBtn.style.display = "block";
  if (win) {
    resultMessage.textContent = `Gratulacje! To faktycznie "${secretSong.title}"!`;
    spawnParticles();
    mediaButtons.innerHTML = "";
    const spotifyButton = document.createElement("button");
    spotifyButton.className = "restart-btn";
    spotifyButton.textContent = "Otwórz na Spotify";
    spotifyButton.onclick = function() {
      window.open("https://open.spotify.com/search/" + encodeURIComponent(secretSong.title), "_blank");
    };
    const youtubeButton = document.createElement("button");
    youtubeButton.className = "restart-btn";
    youtubeButton.textContent = "Otwórz na YouTube";
    youtubeButton.onclick = function() {
      window.open("https://www.youtube.com/results?search_query=" + encodeURIComponent(secretSong.title), "_blank");
    };
    mediaButtons.appendChild(spotifyButton);
    mediaButtons.appendChild(youtubeButton);
    mediaButtons.style.display = "flex";
  } else {
    resultMessage.textContent = `Koniec prób! Poprawna odpowiedź: "${secretSong.title}".`;
  }
  coverImage.src = secretSong.cover;
  coverImage.alt = secretSong.title;
  coverImage.style.display = "block";
  
  resultMessage.scrollIntoView({ behavior: "smooth", block: "center" });
  
}

function startGame() {
  document.querySelectorAll(".guess-row").forEach(row => row.remove());
  attempts = 0;
  gameOver = false;
  guessInput.value = "";
  guessInput.disabled = false;
  guessBtn.disabled = false;
  resultMessage.textContent = "";
  coverImage.style.display = "none";
  coverImage.src = "";
  restartBtn.style.display = "none";
  mediaButtons.innerHTML = "";
  mediaButtons.style.display = "none";
  eliminatedTitles = [];
  suggestionsContainer.innerHTML = "";
  suggestionsContainer.style.display = "none";
  particleContainer.innerHTML = "";
  secretSong = songs[Math.floor(Math.random() * songs.length)];
  console.log("Tajna piosenka:", secretSong.title);
}

guessBtn.addEventListener("click", handleGuess);
guessInput.addEventListener("keypress", (e) => {
  if (e.key === "Enter") {
    handleGuess();
  }
});
restartBtn.addEventListener("click", startGame);

startGame();

const numDots = 100; // z
const dotsContainer = document.getElementById('dots-container');

for (let i = 0; i < numDots; i++) {
  const dot = document.createElement('div');
  dot.classList.add('dot');
  
  const size = Math.random() * 4 + 2;
  dot.style.width = size + 'px';
  dot.style.height = size + 'px';
  
  dot.style.left = Math.random() * window.innerWidth + 'px';
  dot.style.top = Math.random() * window.innerHeight + 'px';
  
  const dx = (Math.random() - 0.5) * 300;
  const dy = (Math.random() - 0.5) * 300;
  dot.style.setProperty('--dx', dx + 'px');
  dot.style.setProperty('--dy', dy + 'px');
  
  const duration = Math.random() * 10 + 5;
  dot.style.animationDuration = duration + 's';
  
  const delay = Math.random() * 5;
  dot.style.animationDelay = delay + 's';
  
  dotsContainer.appendChild(dot);
}

function endGame(win) {
    gameOver = true;
    guessInput.disabled = true;
    guessBtn.disabled = true;
    restartBtn.style.display = "block";

    if (win) {
        resultMessage.textContent = `Gratulacje! To faktycznie "${secretSong.title}"!`;
        spawnParticles();

        mediaButtons.innerHTML = "";

        const spotifyButton = document.createElement("button");
        spotifyButton.className = "spotify-btn";
        spotifyButton.innerHTML = `
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm121.6 365.9c-4.1 6.8-13.2 9.3-20.3 5.2-55.7-33.7-125.9-41.3-209.7-23.7-7.8 1.7-15.8-3.3-17.5-11.2-1.7-7.8 3.3-15.8 11.2-17.5 89.7-19 166.8-10.4 229.3 27.4 6.9 4.1 9.3 13.2 5.2 20.3z"></path></svg>
            Spotify
        `;
        spotifyButton.onclick = () => window.open("https://open.spotify.com/search/" + encodeURIComponent(secretSong.title), "_blank");

        const youtubeButton = document.createElement("button");
        youtubeButton.className = "youtube-btn";
        youtubeButton.innerHTML = `
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path fill="currentColor" d="M232 368V208l144 80-144 80z"></path></svg>
            YouTube
        `;
        youtubeButton.onclick = () => window.open("https://www.youtube.com/results?search_query=" + encodeURIComponent(secretSong.title), "_blank");

        mediaButtons.appendChild(spotifyButton);
        mediaButtons.appendChild(youtubeButton);
        mediaButtons.style.display = "flex";

    } else {
        resultMessage.textContent = `Koniec prób! Poprawna odpowiedź: "${secretSong.title}".`;
    }

    coverImage.src = secretSong.cover;
    coverImage.alt = secretSong.title;
    coverImage.style.display = "block";
}


